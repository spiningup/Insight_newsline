/**
 * Vertical timeline plugin for jQuery.  Data powered
 * by Google Docs.
 *
 * Sharing is using old APIs and breaks in some browsers.
 */(function(e,t,n){e.fn.verticalTimeline=function(t){var n={key:"https://docs.google.com/spreadsheet/pub?key=0AsmHVq28GtVJdG1fX3dsQlZrY18zTVA2ZG8wTXdtNHc&output=html",sheetName:"Posts",defaultDirection:"newest",defaultExpansion:"expanded",groupFunction:"groupSegmentByYear",sharing:!1,gutterWidth:56,width:"auto",handleResize:!1,tabletopOptions:{},columnMapping:{title:"title",title_icon:"title icon",date:"date",display_date:"display date",photo_url:"photo url",caption:"caption",body:"body",read_more_url:"read more url",title:"title"},postTemplate:'         <div class="item post">           <div class="inner">             <div class="timestamp">{{timestamp}}</div>             <div class="title">                 <h3>                 {{#if title_icon}}<img class="title-icon" src="{{title_icon}}" />{{/if}}                 {{title}}                 </h3>             </div>             <div class="date">{{display_date}}</div>             <div class="body">               {{#if photo_url}}                 <img src="{{photo_url}}" alt="">               {{/if}}               {{#if caption}}                 <div class="caption">({{caption}})</div>               {{/if}}               {{#if body}}                 <div class="text">{{{body}}}</div>               {{/if}}               <div class="clearfix">                 {{#if read_more_url}}                   <a target="_blank" class="more" href="{{read_more_url}}">READ MORE</a>                   {{#if sharing}}                     <div class="share">                       <a href="#" class="share-trigger"></a>                       <div class="share-popup">                         <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{read_more_url}}" data-text="{{title}}" data-count="none">Tweet</a>                         <a class="facebook-share-button" name="fb_share" type="button" share_url="{{read_more_url}}">Share</a>                       </div>                     </div>                   {{/if}}                 {{/if}}               </div>             </div>           </div>         </div>       ',groupMarkerTemplate:'         <div class="item group-marker item-group-{{id}}" data-id="{{id}}">           <div class="inner">             <div class="inner2">               <div class="timestamp">{{timestamp}}</div>               <div class="group">{{groupDisplay}}</div>             </div>           </div>         </div>       ',buttonTemplate:'         <div class="vertical-timeline-buttons">           <div class="expand-collapse-buttons">             <a class="expand-all active" href="#"><span>Expand all</span></a>             <a class="collapse-all" href="#"><span>Collapse all</span></a>           </div>           <div class="sort-buttons">             <a class="sort-newest active" href="#"><span>Newest first</span></a>             <a class="sort-oldest" href="#"><span>Oldest first</span></a>           </div>         </div>       ',timelineTemplate:'         <div class="vertical-timeline-timeline">           <div class="line-container">             <div class="line"></div>           </div>         </div>       '},r=function(e,t,n){var r=(new Date(e.timestamp)).getFullYear(),i=r.toString(),s=i.slice(0,-1);return t[s]={id:s,groupDisplay:s+"0's",timestamp:n=="newest"?Date.parse("December 31, "+s+"9"):Date.parse("January 1, "+s+"0"),timestampStart:Date.parse("January 1, "+s+"0"),timestampEnd:Date.parse("December 31, "+s+"9")},t},i=function(e,t,n){var r=(new Date(e.timestamp)).getFullYear();return t[r]={id:r,groupDisplay:r,timestamp:n=="newest"?Date.parse("December 31, "+r):Date.parse("January 1, "+r),timestampStart:Date.parse("January 1, "+r),timestampEnd:Date.parse("December 31, "+r)},t},s=e.extend(n,t);return s.groupFunction=s.groupFunction==="groupSegmentByYear"?i:s.groupFunction,s.groupFunction=s.groupFunction==="groupSegmentByDecade"?r:s.groupFunction,this.each(function(){var t=e(this),n={},r={};t.addClass("vertical-timeline-container"),t.html(s.buttonTemplate+s.timelineTemplate),r.setupTimeline=function(i,o){var u=Handlebars.compile(s.postTemplate),a=Handlebars.compile(s.groupMarkerTemplate);o&&(i=o.sheets(s.sheetName).all()),e.each(i,function(e,r){n=s.groupFunction(r,n,s.defaultDirection),r.sharing=s.sharing,t.find(".vertical-timeline-timeline").append(u(r))}),e.each(n,function(e,n){t.find(".vertical-timeline-timeline").append(a(n))}),r.handleSharing(),r.handleExpanding(),r.handleSorting(),r.adjustWidth(),r.handleResizing(),t.find(".vertical-timeline-timeline").imagesLoaded(function(){t.find(".vertical-timeline-timeline").isotope({itemSelector:".item",transformsEnabled:!0,layoutMode:"spineAlign",spineAlign:{gutterWidth:s.gutterWidth},getSortData:{timestamp:function(e){return parseFloat(e.find(".timestamp").text())}},sortBy:"timestamp",sortAscending:s.defaultDirection=="newest"?!1:!0,itemPositionDataEnabled:!0,onLayout:function(e,t){r.adjustLine()}})})},r.handleSharing=function(){s.sharing&&(e.getScript("//static.ak.fbcdn.net/connect.php/js/FB.Share"),e.getScript("//platform.twitter.com/widgets.js"),t.find(".vertical-timeline-timeline .post .share").hover(function(){e(this).find(".share-trigger").addClass("over"),e(this).find(".share-popup").show()},function(){e(this).find(".share-trigger").removeClass("over"),e(this).find(".share-popup").hide()}))},r.handleExpanding=function(){t.find(".vertical-timeline-timeline .item.post").each(function(){e(this).find(".inner").append('<a href="#" class="open-close"></a>')}),s.defaultExpansion!="expanded"&&(t.find(".vertical-timeline-timeline .item").each(function(){var t=e(this);t.find(".body").hide(),t.find(".post").toggleClass("closed")}),t.find(".expand-collapse-buttons a").removeClass("active"),t.find(".expand-collapse-buttons a.collapse-all").addClass("active")),t.find(".vertical-timeline-timeline .item a.open-close").click(function(n){e(this).siblings(".body").slideToggle(function(){t.find(".vertical-timeline-timeline").isotope("reLayout")}),e(this).parents(".post").toggleClass("closed"),t.find(".expand-collapse-buttons a").removeClass("active"),n.preventDefault()}),t.find(".vertical-timeline-buttons a.expand-all").click(function(n){t.find(".post .body").slideDown(function(){t.find(".vertical-timeline-timeline").isotope("reLayout")}),t.find(".post").removeClass("closed"),t.find(".expand-collapse-buttons a").removeClass("active"),e(this).addClass("active"),n.preventDefault()}),t.find(".vertical-timeline-buttons a.collapse-all").click(function(n){t.find(".post .body").slideUp(function(){t.find(".vertical-timeline-timeline").isotope("reLayout")}),t.find(".post").addClass("closed"),t.find(".expand-collapse-buttons a").removeClass("active"),e(this).addClass("active"),n.preventDefault()})},r.handleSorting=function(){s.defaultDirection!="newest"&&(t.find(".sort-buttons a").removeClass("active"),t.find(".sort-buttons a.sort-oldest").addClass("active")),t.find(".sort-buttons a").click(function(n){var i=e(this);if(i.hasClass("active"))return!1;t.find(".sort-buttons a").removeClass("active"),i.addClass("active"),i.hasClass("sort-newest")?(r.updateGroupMarkers(!1),t.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!1})):(r.updateGroupMarkers(!0),t.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!0})),n.preventDefault()})},r.handleResizing=function(){s.handleResize===!0&&t.resize(function(){r.adjustWidth(),r.adjustLine()})},r.updateGroupMarkers=function(r){t.find(".group-marker").each(function(){var t=e(this),i=t.attr("data-id"),s=r?n[i].timestampStart:n[i].timestampEnd;t.find(".timestamp").text(s)})},r.adjustWidth=function(){var e=s.width,n=t.width(),r,i;s.width==="auto"&&(e=n+"px"),t.find(".vertical-timeline-timeline").width(e),r=t.find(".vertical-timeline-timeline").width(),i=r/2-s.gutterWidth/2-4,t.find(".vertical-timeline-timeline .post").width(i)},r.adjustLine=function(){var e=t.find(".item.last"),n=e.data("isotope-item-position"),r=e.find(".date").height(),i=e.find(".date").position(),s=parseInt(e.find(".inner").css("marginTop")),o=i==null?0:parseInt(i.top),u=n!=null&&n.y!=null?parseInt(n.y):0,a=u+s+o+r/2,f=t.find(".line"),l=t.find(".vertical-timeline-timeline"),c=l.width()/2-f.width()/2;f.height(a).css("left",c+"px")},r.parseRow=function(t){return e.each(s.columnMapping,function(e,n){n=n.split(" ").join(""),t[n]&&(t[e]=t[n])}),t.timestamp=Date.parse(t.date),t};if(e.isArray(s.data)&&s.data.length>0)data=[],e.each(s.data,function(e,t){data.push(r.parseRow(t))}),r.setupTimeline(data,!1);else{var i=e.extend({key:s.key,callback:r.setupTimeline,wanted:[s.sheetName],postProcess:r.parseRow},s.tabletopOptions);Tabletop.init(i)}})},e.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:0,lastY:-60}},e.Isotope.prototype._spineAlignLayout=function(t){var n=this,r=this.spineAlign,i=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,s=Math.round(this.element.width()/2);t.each(function(o,u){var a=e(this);a.removeClass("last").removeClass("top"),o==t.length-1&&a.addClass("last");var f,l;if(a.hasClass("group-marker")){var c=a.width();f=s-c/2,r.colA>=r.colB?(l=r.colA,l==0&&a.addClass("top"),r.colA+=a.outerHeight(!0),r.colB=r.colA):(l=r.colB,l==0&&a.addClass("top"),r.colB+=a.outerHeight(!0),r.colA=r.colB)}else{a.removeClass("left").removeClass("right");var h=r.colB>=r.colA;h?a.addClass("left"):a.addClass("right"),f=h?s-(a.outerWidth(!0)+i/2):s+i/2,l=h?r.colA:r.colB;if(l-r.lastY<=60){var p=60-Math.abs(l-r.lastY);a.find(".inner").css("marginTop",p),r.lastY=l+p}else a.find(".inner").css("marginTop",0),r.lastY=l;r[h?"colA":"colB"]+=a.outerHeight(!0)}n._pushPosition(a,f,l)})},e.Isotope.prototype._spineAlignGetContainerSize=function(){var e={};return e.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"],e},e.Isotope.prototype._spineAlignResizeChanged=function(){return!0}})(jQuery,window);